{% extends "skeleton.html" %}

{% block title %}{{ product }}{% endblock %}
{% block content %}
<h1>{{ product }}</h1>
<div class="row">
    <div class="col-xs-7 col-md-8 col-lg-9">
        <div class="row">
            <div class="{% if product.photos %}col-xs-12{% else %}hidden-xs{% endif %} col-md-5 col-lg-6">
                {% if product.photos -%}
                <a href="{{ product.photos[0].url }}" target="_blank" class="thumbnail" onclick="display('{{ product.photos[0].url }}'); return false;">
                    <img src="{{ product.photos[0].preview_url }}">
                </a>
                {% if product.photos|length > 1 -%}
                {% set thumb_width = (12 / (product.photos|length - 1))|int %}
                {% set thumb_pre = ((12 % (product.photos|length - 1 )) / 2)|int %}
                <div class="row small-gutter">
                    {% for photo in product.photos[1:] %}
                    <div class="col-xs-{{ thumb_width }}">
                        <a href="{{ photo.url }}" target="_blank" class="thumbnail" onclick="display('{{ photo.url }}'); return false;">
                            <img src="{{ photo.thumbnail_url }}">
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {%- endif %}
                {%- else -%}
                <div class="panel panel-default product-illustration-placeholder">
                    <div class="panel-body">
                        <i class="fa fa-ban"></i>
                    </div>
                </div>
                {%- endif %}
            </div>
            <div class="col-xs-12 col-md-7 col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">
                            <i class="fa fa-ellipsis-h"></i>
                            {{ _('Summary') }}
                        </h2>
                    </div>
                    <div class="panel-body">
                        <p>{{ product.output_description|safe }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-5 col-md-4 col-lg-3">
        <div class="well">
            <p class="price">{{ product.get_price_per_item().quantize('0.01').net }} {{ config.CURRENCY }}</p>
        <hr>
        {% if product.stock -%}
        <form method="POST" action="{{ url_for('add_to_cart') }}">
            <input type="hidden" name="product" value="{{ product.id }}">
            <div class="form-group">
                <label for="quantity">{{ _('Quantity') }}</label>
                <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn btn-default" id="dec_quantity">-</button>
                    </span>
                    <input type="text" id="quantity" name="quantity" class="form-control text-center" value="1">
                    <span class="input-group-btn">
                        <button class="btn btn-default" id="inc_quantity">+</button>
                    </span>
                </div>
            </div>
            <div id="quantity-message" class="alert alert-danger hidden">{{ _('Sorry, insufficient stock.') }}</div>
            <button id="add-to-cart" class="btn btn-success btn-lg btn-block">
                {{ _('Add to cart') }}
            </button>
        </form>
        {%- else -%}
        <button class="btn btn-danger btn-lg btn-block disabled">
            {{ _('Out of stock') }}
        </button>
        {%- endif %}
        </div>
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-heading">
        <h2 class="panel-title">
            <i class="fa fa-book"></i>
            {{ _('Documentation') }}
        </h2>
    </div>
    <div class="panel-body">
        {{ product.output_documentation|safe }}
    </div>
</div>
<div id="alert-overlay" class="hidden" onclick="this.className='hidden';">
    <div class="overlay">
    </div>
    <div class="alert alert-danger overlay-content">
        <i class="fa fa-exclamation-triangle"></i>
        <span class="sr-only">{{ _('Warning:') }}</span>
        {{ _('Sorry, insufficient stock.') }}
    </div>
</div>
<div id="image-overlay" class="hidden" onclick="this.className='hidden';">
    <div class="overlay">
    </div>
    {#<div id="overlay-image-container" class="img-thumbnail overlay-content">#}
    <div id="overlay-image-container">
        <img src="" id="overlay-image">
    </div>
</div>
<script>
    function display(img_url) {
        document.getElementById("overlay-image").src = img_url;
        document.getElementById("image-overlay").className = "";
    };
    document.getElementById('inc_quantity').addEventListener('click', function(e) {
        e.preventDefault();
        var orig = parseInt(document.getElementById('quantity').value);
        if (orig < {{ product.stock - cart.quantity(product) }}) {
            document.getElementById('quantity').value = orig + 1;
        } else {
            document.getElementById("alert-overlay").className = "";
        };
    });
    document.getElementById('dec_quantity').addEventListener('click', function(e) {
        e.preventDefault();
        var orig = parseInt(document.getElementById('quantity').value);
        if (orig > 1) {
            document.getElementById('quantity').value = orig - 1;
        };
    });
</script>
{% endblock %}

