{#-
Copyright 2015-2016 SÃ©bastien Maccagnoni-Munch

This file is part of AwesomeShop.

AwesomeShop is free software: you can redistribute it and/or modify it under
the terms of the GNU Affero General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version.

AwesomeShop is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more
details.

You should have received a copy of the GNU Affero General Public License
along with AwesomeShop. If not, see <http://www.gnu.org/licenses/>.
#}
<div ng-repeat-start="product in products" class="col-xs-6 col-md-4 col-lg-3">
    <div class="thumbnail product-in-grid">
        <a href="">{# XXX link to product #}
            <img ng-src="[[ product.main_photo.preview_url ]]" ng-show="product.main_photo">
            <div class="caption">
                <p class="text-center">[[ product.name ]]</p>
                <p class="text-center">[[ product.net_price ]] {{ config.CURRENCY }}</p>
                <button class="btn btn-success btn-block" ng-if="product.stock>0">{# XXX deduce stock in cart #}
                    {{ _('Add to cart') }}
                </button>
                <button class="btn btn-danger btn-block disabled" ng-if="product.stock==0&&!product.on_demand">
                    {{ _('Out of stock') }}
                </button>
                <button class="btn btn-info btn-block" ng-if="product.stock==0&&product.on_demand">
                    {{ _('Add to cart') }}
                </button>
                <p class="text-center bottom-no-space" ng-if="product.stock==0&&product.on_demand">
                    {{ _('Available on demand, delay %(min)d-%(max)d days', min=config.ON_DEMAND_DELAY_MIN, max=config.ON_DEMAND_DELAY_MAX) }}
                </p>
            </div>
        </a>
    </div>
</div>
<div class="clearfix visible-lg-block" ng-if="($index+1)%4==0"></div>
<div class="clearfix visible-md-block" ng-if="($index+1)%3==0"></div>
<div ng-repeat-end class="clearfix visible-xs-block visible-sm-block" ng-if="($index+1)%2==0"></div>

{#
{% block button %}
{%- if product.get_stock() - cart.quantity(product) > 0 %}
<form method="POST" action="{{ url_for('add_to_cart') }}">
    <input type="hidden" name="product" value="{{ product.id }}">
    <input type="hidden" name="quantity" value="1">
    <button class="btn btn-success btn-block">{{ _('Add to cart') }}</button>
</form>
{%- elif product.on_demand %}
<form method="POST" action="{{ url_for('add_to_cart') }}">
    <input type="hidden" name="product" value="{{ product.id }}">
    <input type="hidden" name="quantity" value="1">
    <button class="btn btn-info btn-block">{{ _('Add to cart') }}</button>
    <p class="text-center bottom-no-space">{{ _('Available on demand, delay %(min)d-%(max)d days', min=config.ON_DEMAND_DELAY_MIN, max=config.ON_DEMAND_DELAY_MAX) }}</p>
</form>
{%- else %}
<button class="btn btn-danger btn-block disabled">{{ _('Out of stock') }}</button>
{%- endif %}
{% endblock %}
#}
